# 3 Web 优化的动机与方式
# 3.1当前性能挑战
## 流程
web页面请求流程
![[Pasted image 20240614201711.png]]

页面渲染流程
![[Pasted image 20240614201748.png]]

## 关键性能指标：
- **延迟**。 延迟是指 IP 数据包从一个网络端点到另一个网络端点所花费的时间。与之相关的是往 返时延（RTT），它是延迟的时间的两倍。延迟是制约 Web 性能的主要瓶颈，尤其对于 HTTP 这样的协议，因为其中包含大量往返于服务器的请求。

- **带宽**。只要带宽没有饱和，两个网络端点之间的连接会一次处理尽可能多的数据量。依据 Web 页面引用资源的大小和网络连接的传输能力，带宽可能会成为性能的瓶颈。

- **DNS查询**。在客户端能够获取 Web 页面前，它需要通过域名系统（DNS）把主机名称转换成 IP 地址，DNS 相当于互联网上的电话号码簿（今天可能没有多少年轻人知道号码簿了）。获取的 HTML 页面中所引用的各个不同域名也需要转换；幸运的是，一个域名只需转换一次。 

- **建立连接时间**。在客户端和服务器之间建立连接需要往返数据应答，称为“三次握手”。握手时间一般与客户端和服务器之间的延迟有关。握手过程包括客户端向服务器发起一个 SYN 包，接着服务器返回对应 SYN 的 ACK 响应以及新的 SYN 包，然后客户端返回对应的 ACK，如图 3-3 所示。
![[Pasted image 20240614202127.png]]

- **TLS协商时间**。如果客户端发起 HTTPS 连接，它还需要进行传输层安全协议（TLS）协商；TLS 用来 取代安全套接层（SSL）。除了服务器和客户端的计算处理耗时之外，TLS 还会造成额 外的往返传输。

目前为止，客户端还没有真正发起 HTTP 请求，却已经用掉了 DNS 查询的往返时间，以 及 TCP 和 TLS 的耗时。下面的指标严重依赖于页面内容本身或服务器性能，而不是网络。

- **首字节时间（TTFB）**。TTFB 是指客户端从开始定位到 Web 页面，至接收到主体页面响应的第一字节所耗费的时间。它包含了之前提到的各种耗时，还要加上服务器处理时间。对于主体页面上的 资源，TTFB 测量的是从浏览器发起请求至收到其第一字节之间的耗时。

- **内容下载时间**。 等同于被请求资源的最后字节到达时间（TTLB）。 
 
- **开始渲染时间**。客户端的屏幕上什么时候开始显示内容？这个指标测量的是用户看到空白页面的时长。

- **文档加载完成时间**（又叫页面加载时间）。 这是客户端浏览器认为页面加载完毕的时间。（load事件）
## HTTP/1的问题
1. 队头阻塞
